2021年度 サブゼミ 第11回 データハンドリング2
================
Yoshinari Namba
2021/6/24

|                                   |
|-----------------------------------|
| データハンドリングの第2回目です． |

# 0. Setup & Agenda

## 準備1: データ

今日は以下のデータを使用します．コピペして実行しておいてください．

``` r
# 今日使うデータの作成
df_score <- data.frame(name = c('生徒C', '生徒A', '生徒B', '生徒A'), 
                 class_size = c('small', 'large', 'small', 'large'), 
                 math_score = c(80, 70, 75, 70), 
                 eng_score = c(70, 75, 80, 75))
# 確認
df_score
```

    ##    name class_size math_score eng_score
    ## 1 生徒C      small         80        70
    ## 2 生徒A      large         70        75
    ## 3 生徒B      small         75        80
    ## 4 生徒A      large         70        75

## 準備2: パッケージ

今日も`tidyverse`を使用します．インストールが済んでいない人は先ず`install.packages('tidyverse')`を実行してくださいね．

``` r
# tidyverseの呼び出し
library(tidyverse)
```

    ## Warning: package 'tidyverse' was built under R version 4.0.3

    ## -- Attaching packages --------------------------------------- tidyverse 1.3.0 --

    ## v ggplot2 3.3.1     v purrr   0.3.4
    ## v tibble  3.0.1     v dplyr   1.0.2
    ## v tidyr   1.1.0     v stringr 1.4.0
    ## v readr   1.3.1     v forcats 0.5.0

    ## Warning: package 'tidyr' was built under R version 4.0.2

    ## Warning: package 'dplyr' was built under R version 4.0.3

    ## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

## Agenda

今日のAgendaは次の通りです． 1. データ整理(続き) 2. 文字列の操作 3.
グループワーク

# 1. データ整理

前回は主に`dplyr`を使った行列の扱い方や集計方法を学びました．今回は前回の続きです．  
まずは復習がてら前回のグループワークの答えを確認したいと思います．

``` r
# データの取り込み
df_review <- read.csv('wage1_editted.csv')
head(df_review) # 確認
```

    ##    wage educ exper female married industry
    ## 1  3.24   12    22      1       1 services
    ## 2  3.00   11     2      0       0    trade
    ## 3  8.75   16     9      0       1 profserv
    ## 4 11.25   18    15      0       0    trade
    ## 5  3.60   12    26      1       0    trade
    ## 6  6.25   16     8      1       0    trade

``` r
# 教育過剰・教育過少を作成
df_review_ans <- df_review %>% 
  group_by(industry) %>% # 職業区分industry でグループ化
  mutate(ad_educ = mean(educ)) %>% # 適正教育年数 ad_educを定義
  ungroup() %>% #グループ解除
  mutate(ov_educ = ifelse(educ - ad_educ > 0, educ - ad_educ, 0), # 教育過剰年数 ov_educを定義
         un_educ = ifelse(educ - ad_educ < 0, ad_educ - educ, 0)) # 教育過少年数 un_educを定義
head(df_review_ans) #確認
```

    ## # A tibble: 6 x 9
    ##    wage  educ exper female married industry ad_educ ov_educ un_educ
    ##   <dbl> <int> <int>  <int>   <int> <chr>      <dbl>   <dbl>   <dbl>
    ## 1  3.24    12    22      1       1 services    12.0  0.0377   0    
    ## 2  3       11     2      0       0 trade       12.3  0        1.30 
    ## 3  8.75    16     9      0       1 profserv    13.6  2.43     0    
    ## 4 11.2     18    15      0       0 trade       12.3  5.70     0    
    ## 5  3.60    12    26      1       0 trade       12.3  0        0.305
    ## 6  6.25    16     8      1       0 trade       12.3  3.70     0

ちなみに去年の三田論教育班は次のような分析を行いました(実際はパネルデータを使ったり学歴ミスマッチの定義の別の定義の仕方も試していたりするのでもう少し複雑です)．

``` r
out_educ <- lm(data = df_review_ans, 
               log(wage) ~ ad_educ + un_educ + ov_educ + exper + I(exper^2) + female + married)
summary(out_educ)
```

    ## 
    ## Call:
    ## lm(formula = log(wage) ~ ad_educ + un_educ + ov_educ + exper + 
    ##     I(exper^2) + female + married, data = df_review_ans)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1.65277 -0.23585 -0.04511  0.24318  1.27909 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -0.9727850  0.3462130  -2.810 0.005179 ** 
    ## ad_educ      0.1846454  0.0274527   6.726 5.45e-11 ***
    ## un_educ     -0.0418229  0.0122949  -3.402 0.000731 ***
    ## ov_educ      0.1074883  0.0142189   7.560 2.38e-13 ***
    ## exper        0.0352695  0.0055578   6.346 5.51e-10 ***
    ## I(exper^2)  -0.0006590  0.0001207  -5.462 7.89e-08 ***
    ## female      -0.3220350  0.0399404  -8.063 7.15e-15 ***
    ## married      0.0522308  0.0448755   1.164 0.245094    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 0.4021 on 439 degrees of freedom
    ## Multiple R-squared:  0.4183, Adjusted R-squared:  0.409 
    ## F-statistic:  45.1 on 7 and 439 DF,  p-value: < 2.2e-16
